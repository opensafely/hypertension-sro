---
title: "Hypertension QOF Register"
subtitle: "Indicator HYP001"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    code_folding: hide

---

```{r setup, include=FALSE}
# Set Rmd options ----
knitr::opts_chunk$set(echo = TRUE)

# Load packages ----
library(ggplot2)
library(magrittr)
library(dplyr)
library(tidyr)
library(here)
library(knitr)
library(readr)
library(fs)
library(purrr)
library(stringr)
library(gt)

source(here::here("lib", "functions", "fun_plot.R"))
```

```{r load-data, include=FALSE}
# Get file names and path ----
df_measures_hyp001 <- readr::read_csv(here::here("output", "measures_hyp001.csv"))
```

# What it is 

The [Quality and Outcomes Framework (QOF)](https://digital.nhs.uk/data-and-information/data-tools-and-services/data-services/general-practice-data-hub/quality-outcomes-framework-qof) outlines three indicator that focus on hypertension (HYP001, HYP003, and HYP007). 
We aim to use OpenSAFELY to quantify the extent to which the hypertension register (HYP001) was disrupted during the pandemic.

# Why it matters

General practice has been disrupted by the pandemic in many clinical areas (e.g., [Curtis et al., 2021](https://bjgp.org/content/72/714/e63); [Williamson et al., 2020](https://www.nature.com/articles/s41586-020-2521-4)). 
We aim to assess the impact of the pandemic on the routine management of blood pressure. 
High blood pressure is one of the leading risk factors for several diseases (e.g., cardiovascular disease, stroke) worldwide. 
Research suggests that delays in the management of high blood pressure are associated with worse clinical outcomes, for example acute cardiovascular events, or death ([Xu et al., 2015](https://www.bmj.com/content/350/bmj.h158)).

# Business rules

The rules for the Hypertension Register (HYP001, Version: 46.0) are outlined below.
More details about the rules can be found [here](https://digital.nhs.uk/data-and-information/data-collections-and-data-sets/data-collections/quality-and-outcomes-framework-qof/quality-and-outcome-framework-qof-business-rules/qof-business-rules-v46.0-2021-2022-baseline-release).
Dashboards presenting the annual targets of all QOF indicators published by NHSD are available [here](https://digital.nhs.uk/data-and-information/data-tools-and-services/data-services/general-practice-data-hub/quality-outcomes-framework-qof).

# Methods

Using OpenSAFELY-TPP, covering 40% of England's population, we have evaluated the QOF Hypertension register (Indicator: HYP001) between 2019-09-01 and 2022-03-31.
The codelist used can be found here at [OpenSAFELY Codelists](https://codelists.opensafely.org/).

The **study population** for the register was defined following the business rules the (v46).
For each month within the study period, we have calculated the percentage of registered patients with a diagnosis of hypertension which has not been subsequently resolved.
All analytical code and output is available for inspection at the [OpenSAFELY GitHub repository](https://github.com/opensafely/hypertension-sro).

# Results

## HYP001

```{r fig.width=8, fig.height=4}

df_measures_hyp001 %>%
    dplyr::filter(group == "population") %>% 
    plot_qof_indicator(legend = "none")

```

## HYP001 by sex

```{r fig.width=8, fig.height=4}

df_measures_hyp001 %>%
  dplyr::filter(group == "sex") %>% 
  dplyr::mutate(category = factor(category,
                                  levels = c("F", "M"),
                                  labels = c("Female", "Male"))) %>% 
  plot_qof_indicator()

```

## HYP001 by age band

```{r fig.width=8, fig.height=4}

df_measures_hyp001 %>%
  dplyr::filter(group == "age_band") %>% 
  dplyr::filter(category != "missing") %>% 
  plot_qof_indicator(legend = "top")

```

## HYP001 by IMD

```{r fig.width=8, fig.height=4}

df_measures_hyp001 %>%
  dplyr::filter(group == "imd") %>%
  dplyr::mutate(category = factor(category,
                                  levels = c(1:5),
                                  labels = c('1 - Most deprived', '2', '3', '4', '5 - Least deprived'))) %>% 
  dplyr::filter(!is.na(category)) %>% 
  plot_qof_indicator()
```

## HYP001 by region

```{r fig.width=8, fig.height=4}

df_measures_hyp001 %>%
  dplyr::filter(group == "region") %>% 
  plot_qof_indicator()

```

# References 

1. Curtis HJ, MacKenna B, Croker R, Inglesby P, Walker AJ, Morley J, et al. OpenSAFELY NHS Service Restoration Observatory 1: describing trends and variation in primary care clinical activity for 23.3 million patients in England during the first wave of COVID-19. Br J Gen Pract [Internet]. 2021 Sep 20 [cited 2021 Oct 5]; Available from: https://bjgp.org/content/early/2021/09/24/BJGP.2021.0380
1. Williamson EJ, Walker AJ, Bhaskaran K, Bacon S, Bates C, Morton CE, et al. Factors associated with COVID-19-related death using OpenSAFELY. Nature. 2020 Aug;584(7821):430â€“6. https://www.nature.com/articles/s41586-020-2521-4
1. Xu W, Goldberg SI, Shubina M, Turchin A. Optimal systolic blood pressure target, time to intensification, and time to follow-up in treatment of hypertension: population based retrospective cohort study. BMJ. 2015 Feb 5;350:h158. https://www.bmj.com/content/350/bmj.h158
